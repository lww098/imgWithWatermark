!function(t,e){t&&!t.getElementById("livereloadscript")&&((e=t.createElement("script")).async=1,e.src="//"+(self.location.host||"localhost").split(":")[0]+":35729/livereload.js?snipver=1",e.id="livereloadscript",t.getElementsByTagName("head")[0].appendChild(e))}(self.document),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).$ImgWithWaterMark=e()}(this,(function(){"use strict";return class{constructor(t){t=t||{},this.canvas=null,this.fillStyle=t.fillStyle||"#fff",this.text=t.text||"",this.quality=t.quality||.5}createDom(){this.canvas=document.createElement("canvas")}getImgInfo(t){return new Promise(((e,i)=>{let a=new FileReader;a.onload=function(t){let i=new Image;i.src=t.target.result,i.onload=function(){e({width:this.width,height:this.height,image:this})}},a.readAsDataURL(t)}))}setWaterMark({img:t,text:e}){return new Promise((async i=>{e&&(this.text=e),this.context||this.createDom();let a=this.canvas.getContext("2d");const{width:n,height:s,image:l}=await this.getImgInfo(t);a.reset(),a.restore(),this.canvas.width=n,this.canvas.height=s,a.font=`bold ${n/20}px serif`,a.fillStyle=this.fillStyle,a.drawImage(l,0,0,n,s);const o=a.measureText(this.text),c=o.actualBoundingBoxLeft+o.actualBoundingBoxRight,r=o.actualBoundingBoxAscent+o.actualBoundingBoxDescent;a.fillText(e,n-c,s-r),i(this.canvas.toDataURL("image/jpeg"))}))}destoryCanvas(){this.canvas=null}}}));
